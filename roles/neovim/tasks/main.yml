---
# tasks/main.yml for neovim role

- name: Create keyrings directory
  ansible.builtin.file:
    path: /etc/apt/keyrings
    state: directory
    mode: '0755'

- name: Download Neovim PPA key
  ansible.builtin.get_url:
    url: "https://keyserver.ubuntu.com/pks/lookup?op=get&search=0x9DBB0BE9366964F134855E2255F96FCF8231B6DD"
    dest: /etc/apt/keyrings/neovim-ppa.asc
    mode: '0644'

- name: Add Neovim PPA source
  ansible.builtin.apt_repository:
    repo: "deb [signed-by=/etc/apt/keyrings/neovim-ppa.asc] http://ppa.launchpad.net/neovim-ppa/unstable/ubuntu jammy main"
    state: present
    update_cache: yes
  # This task will notify "Update apt cache" but also explicitly updates the cache itself.
  # The "Flush handlers" will still be useful for other potential handlers.

- name: "Install Neovim and Python support"
  ansible.builtin.apt:
    name:
      - neovim
      - python3-neovim
      - python3-dev
      - python3-pip
    state: present
